<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>OccludeX — Free AI Anki Image Occlusion</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="theme-color" content="#0a0a0a">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/tesseract.js@v5.0.3/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/anki-apkg-export@3.2.1/dist/anki-apkg-export.min.js"></script>
</head>
<body>
  <header class="glass topbar">
    <div class="brand">OccludeX</div>
    <div class="actions">
      <button id="installBtn" class="btn">Install</button>
      <button id="exportApkgBtn" class="btn primary">Export .apkg</button>
      <button id="settingsBtn" class="btn">Settings</button>
    </div>
  </header>

  <main>
    <section class="panel glass">
      <h2>Create image occlusion cards</h2>
      <div class="editorPane">
        <div class="editorTop">
          <label class="fileBtn big">
            <input type="file" id="imageInput" accept="image/*"> Choose image from Photos / Files
          </label>
          <button id="scanOcrBtn" class="btn">OCR scan</button>
          <button id="autoOccludeBtn" class="btn">Auto occlude labels</button>
          <button id="oneClickDeckBtn" class="btn primary">Generate occlusion deck</button>
        </div>
        <div class="editorCanvasWrap">
          <canvas id="imgCanvas"></canvas>
          <canvas id="maskCanvas"></canvas>
        </div>
        <div id="progressBar" class="progress hidden"><div id="progressFill"></div><span id="progressText"></span></div>
        <div id="busyOverlay" class="busy hidden">Working…</div>
      </div>
      <div class="editToolbar">
        <span class="chip">Tap mask to select</span>
        <span class="chip">Drag to move</span>
        <span class="chip">Drag corners to resize</span>
        <span class="chip danger">Double-tap = delete</span>
        <button id="undoBtn" class="btn">Undo</button>
        <button id="redoBtn" class="btn">Redo</button>
        <button id="resetViewBtn" class="btn">Reset view</button>
      </div>
      <div id="ocrOutput" class="glass card"></div>
    </section>

    <section class="panel glass">
      <h2>AI flashcards (Gemini)</h2>
      <div class="settingsRow">
        <input type="password" id="geminiKey" placeholder="Gemini API key (stored locally)">
        <select id="aiMode">
          <option value="qa">Q/A</option>
          <option value="cloze">Cloze</option>
          <option value="mcq">MCQ</option>
        </select>
        <button id="generateAiBtn" class="btn">Generate from OCR text</button>
        <button id="suggestOccludeBtn" class="btn">Suggest occlusions (AI)</button>
      </div>
      <textarea id="aiSourceText" placeholder="Paste text or use OCR above"></textarea>
      <div id="aiCards" class="grid"></div>
    </section>

    <section class="panel glass">
      <h2>Deck manager</h2>
      <div class="deckControls">
        <input id="deckName" value="OccludeX Deck">
        <input id="deckTag" value="occludex">
        <button id="saveLocalBtn" class="btn">Save locally</button>
        <button id="loadLocalBtn" class="btn">Load</button>
        <button id="clearLocalBtn" class="btn danger">Clear</button>
      </div>
      <div id="deckList" class="list"></div>
    </section>

    <section class="panel glass">
      <h2>Review (FSRS-style)</h2>
      <div class="reviewControls">
        <button id="startReviewBtn" class="btn">Start</button>
        <label>
          <input type="checkbox" id="fsrsMode" checked> Use FSRS-like scheduling
        </label>
      </div>
      <div id="reviewCard" class="reviewCard glass"></div>
      <div class="reviewBtns">
        <button class="btn" data-rate="again">Again</button>
        <button class="btn" data-rate="hard">Hard</button>
        <button class="btn" data-rate="good">Good</button>
        <button class="btn" data-rate="easy">Easy</button>
      </div>
    </section>
  </main>

  <footer class="glass footer">
    <span>Local-only, no servers. Your data stays on your device.</span>
    <span>Auto theme (light/dark). PWA offline.</span>
  </footer>

  <script src="script.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
